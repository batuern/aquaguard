<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AquaGuard AI - Parsel Bazlı Kuraklık ve Sulama Asistanı</title>
    <!-- Harita Kütüphanesi -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Stil ve Tasarım -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      body { font-family: 'Inter', sans-serif; }
      .map-canvas { height: 500px; width: 100%; border-radius: 1rem; }
      .analysis-panel { transition: all 0.3s ease; }
      .parcel-shape { cursor: pointer; transition: all 0.2s; }
      .parcel-shape:hover { fill-opacity: 0.8; stroke-width: 4; }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <!-- Navigasyon -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-[1000] py-4">
      <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="bg-emerald-600 p-2 rounded-lg">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            </div>
            <span class="font-bold text-xl text-slate-800 tracking-tight">AquaGuard AI</span>
        </div>
        <nav class="hidden md:flex gap-6 text-sm font-medium text-slate-600">
          <a href="#features" class="hover:text-emerald-600">Özellikler</a>
          <a href="#map" class="hover:text-emerald-600 text-emerald-600">Parsel Haritası</a>
          <a href="#report" class="hover:text-emerald-600">Parsel Ekle</a>
        </nav>
        <button class="bg-emerald-600 text-white px-5 py-2 rounded-lg font-bold text-sm shadow-lg shadow-emerald-200">Giriş Yap</button>
      </div>
    </header>

    <!-- Harita Bölümü -->
    <section id="map" class="py-12 max-w-7xl mx-auto px-6">
      <div class="mb-10 text-center">
        <h2 class="text-3xl font-bold text-slate-900 mb-2">Karapınar Pilot Parsel Ağı</h2>
        <p class="text-slate-500">Sentinel-2 verileriyle eşleşen 3 ana parsel üzerinden canlı stres takibi.</p>
      </div>

      <div class="grid lg:grid-cols-12 gap-8">
        <!-- Harita Alanı -->
        <div class="lg:col-span-8 bg-white p-4 rounded-2xl border border-slate-200 shadow-sm relative">
            <div id="leafletMap" class="map-canvas"></div>
            <div class="mt-4 flex gap-4 text-xs font-bold uppercase tracking-wider text-slate-500">
                <div class="flex items-center gap-2"><div class="w-4 h-2 bg-red-500"></div> Kritik</div>
                <div class="flex items-center gap-2"><div class="w-4 h-2 bg-orange-500"></div> Orta</div>
                <div class="flex items-center gap-2"><div class="w-4 h-2 bg-emerald-500"></div> Sağlıklı</div>
            </div>
        </div>

        <!-- Analiz Detay Paneli -->
        <div class="lg:col-span-4 space-y-6">
          <div id="welcomeMsg" class="bg-emerald-50 p-6 rounded-2xl border border-emerald-100">
              <h3 class="font-bold text-emerald-900 mb-2">Pilot Bölge İzleme</h3>
              <p class="text-sm text-emerald-700 leading-relaxed">
                  Haritadaki Karapınar parsellerinden birine tıklayarak o alana özel yapay zeka analizlerini ve NDVI verilerini görüntüleyebilirsiniz.
              </p>
          </div>

          <div id="analysisDetail" class="hidden bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-6">
            <div class="flex justify-between items-start">
              <h3 id="pName" class="text-2xl font-bold text-slate-800">Parsel Adı</h3>
              <span id="pRiskBadge" class="px-3 py-1 rounded-full text-[10px] font-bold"></span>
            </div>

            <div class="grid grid-cols-2 gap-4 text-center">
              <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                <span class="block text-[10px] text-slate-400 font-bold uppercase mb-1">Risk Skoru</span>
                <span id="pRiskVal" class="text-xl font-bold text-slate-800"></span>
              </div>
              <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                <span class="block text-[10px] text-slate-400 font-bold uppercase mb-1">Mevcut NDVI</span>
                <span id="pNdviVal" class="text-xl font-bold text-slate-800"></span>
              </div>
            </div>

            <div class="bg-slate-900 p-5 rounded-xl text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h4 class="text-emerald-400 text-xs font-bold uppercase mb-2">Sulama Önerisi</h4>
                    <p id="pAdvice" class="text-sm font-medium leading-relaxed"></p>
                </div>
            </div>

            <div class="pt-4 border-t border-slate-100">
                <div class="text-[10px] text-slate-400 font-bold uppercase mb-2">Koordinat Bilgisi</div>
                <code id="pCoords" class="text-xs bg-slate-100 p-2 rounded block text-slate-600 font-mono"></code>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Script: Harita ve Koordinat Kontrolü -->
    <script>
      // Veri setindeki 3 gerçek Karapınar koordinatı
      const PARCELS = [
        { 
          id: "A", name: "Parsel A (Mısır)", lat: 37.7127, lon: 33.6069, risk: 92, ndvi: 0.38, 
          advice: "Kritik stres! Buharlaşmayı önlemek için bu gece 22:00'den sonra 30mm sulama yapılması önerilir." 
        },
        { 
          id: "B", name: "Parsel B (Tahıl)", lat: 37.7500, lon: 33.6500, risk: 48, ndvi: 0.52, 
          advice: "Orta seviye risk. Toprak nemi azalıyor, önümüzdeki 48 saat içinde hafif sulama planlayın." 
        },
        { 
          id: "C", name: "Parsel C (Patates)", lat: 37.6800, lon: 33.5500, risk: 12, ndvi: 0.65, 
          advice: "Bitki sağlığı optimal. Şu an için sulama önerilmiyor, 7 gün sonra takibe devam edin." 
        }
      ];

      // Haritayı Karapınar pilot bölgesi merkezli başlat
      const map = L.map('leafletMap').setView([37.7150, 33.6000], 12);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© AquaGuard AI | Sentinel-2 | ERA5'
      }).addTo(map);

      // Noktaları Parsel Şeklinde (Dikdörtgen) Haritaya Ekle
      PARCELS.forEach(p => {
        let riskColor = p.risk > 80 ? '#ef4444' : (p.risk > 40 ? '#f59e0b' : '#10b981');
        
        // Koordinat merkezli küçük bir dikdörtgen (parsel şekli simülasyonu)
        const bounds = [
            [p.lat - 0.003, p.lon - 0.005], 
            [p.lat + 0.003, p.lon + 0.005]
        ];
        
        const rect = L.rectangle(bounds, {
          className: 'parcel-shape',
          color: "#fff",
          weight: 2,
          fillColor: riskColor,
          fillOpacity: 0.6
        }).addTo(map);

        // Tıklama olayı
        rect.on('click', () => {
          document.getElementById('welcomeMsg').classList.add('hidden');
          const panel = document.getElementById('analysisDetail');
          panel.classList.remove('hidden');

          document.getElementById('pName').innerText = p.name;
          document.getElementById('pCoords').innerText = `${p.lat}, ${p.lon}`;
          document.getElementById('pRiskVal').innerText = `%${p.risk}`;
          document.getElementById('pNdviVal').innerText = p.ndvi;
          document.getElementById('pAdvice').innerText = p.advice;

          const badge = document.getElementById('pRiskBadge');
          badge.innerText = p.risk > 80 ? 'KRİTİK' : (p.risk > 40 ? 'RİSKLİ' : 'SAĞLIKLI');
          badge.className = `px-3 py-1 rounded-full text-[10px] font-bold ${p.risk > 80 ? 'bg-red-100 text-red-600' : (p.risk > 40 ? 'bg-orange-100 text-orange-600' : 'bg-emerald-100 text-emerald-600')}`;

          map.flyTo([p.lat, p.lon], 14);
        });

        // Hover Tooltip
        rect.bindTooltip(`<b>${p.name}</b>`, { direction: 'top', offset: [0, -5] });
      });
    </script>
  </body>
</html>
